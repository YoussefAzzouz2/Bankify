{% extends 'backbase.html.twig' %}

{% block title %}<title>Cartes</title>{% endblock %}

{% block content %}
    <center><h1>Les cartes </h1></center>
    <input type="text" id="searchInput" placeholder="Search">
<ul id="cartesList"></ul>

    <center>
    <table class="table">
        <thead>
            <tr>
                <th>Id</th>
                <th>Numero</th>
                <th>Date_Expiration</th>
                <th>Network</th>
                <th>Statue de la carte</th>
                <th>Type</th>
                <th>actions</th>
            </tr>
        </thead>
        <tbody>
        {% for carte in cartes %}
            <tr>
                <td>{{ carte.id }}</td>
                <td>{{ carte.NumC }}</td>
                <td>{{ carte.DateExp ? carte.DateExp|date('Y-m-d') : '' }}</td>
                <td>{{ carte.TypeC }}</td>
                <td>{{ carte.StatutC }}</td>
                <td>
                    {% if carte.getType() is not null %}
                    {{ carte.getType().Type }}
                    {% endif %}
                </td>
                <td>
                    
                    <a class="btn btn-primary" href="{{ path('app_carte_edit', {'id': carte.id}) }}">edit</a>
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="6">no records found</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    </center>
    <center><a class="btn btn-primary" href="{{ path('app_carte_new') }}">Create new</a></center>
    <center><a class="btn btn-primary" href="{{ path('generate_pdf') }}">Generate PDF</a></center>
    <canvas id="cardTypeChart" width="200" height="200"></canvas>
{% endblock %}

{% block javascripts %}
<script>
document.getElementById('searchInput').addEventListener('input', function() {
    let query = this.value.trim();
    if (query.length > 0) {
        fetch(`/carte/search?q=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(data => {
                displayCartes(data);
            })
            .catch(error => {
                console.error('Error:', error);
            });
    } else {
        clearCartesList();
    }
});

function displayCartes(cartes) {
    let cartesList = document.getElementById('cartesList');
    cartesList.innerHTML = '';
    cartes.forEach(carte => {
        let li = document.createElement('li');
        li.textContent = `ID: ${carte.id}, Numero: ${carte.NumC}, Type: ${carte.TypeC}, Statut: ${carte.StatutC}`;
        cartesList.appendChild(li);
    });
}

function clearCartesList() {
    document.getElementById('cartesList').innerHTML = '';
}
</script>




<script>
document.addEventListener("DOMContentLoaded", function() {
    const ctx = document.getElementById('cardTypeChart').getContext('2d');
    
    const visaCount = {{ visaCount }};
    const mastercardCount = {{ mastercardCount }};
    
    new Chart(ctx, {
        type: 'pie',
        data: {
            labels: ['Visa', 'Mastercard'],
            datasets: [{
                label: 'Card Types',
                data: [visaCount, mastercardCount],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.6)', // Red color for Visa
                    'rgba(54, 162, 235, 0.6)', // Blue color for Mastercard
                ],
                borderWidth: 1
            }]
        },
        options: {
            
            title: {
                display: true,
                text: 'Card Types Distribution'
            }
        }
    });
});
</script>
{% endblock %}
